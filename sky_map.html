<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SDSS F Stars Sky Map</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f2f5;
        }
        #sky-plot {
            width: 100%;
            height: 700px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #spectrum-popup {
            display: none;
            position: fixed;
            z-index: 1000;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
            padding: 10px;
            max-width: 650px;
            pointer-events: none;
        }
        #spectrum-popup img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
        #spectrum-popup .info {
            font-size: 12px;
            color: #333;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
            font-family: monospace;
        }
        #spectrum-popup .info span {
            display: inline-block;
            margin-right: 15px;
        }
        .header {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }
        .header h1 {
            margin: 0 0 5px 0;
            font-size: 24px;
        }
        .header p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        .legend {
            text-align: center;
            margin-top: 10px;
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>SDSS DR18 F Stars Sky Map</h1>
        <p>Hover over a star to see its spectrum. Points colored by metallicity [Fe/H].</p>
    </div>
    <div id="sky-plot"></div>
    <div id="spectrum-popup">
        <img id="popup-img" src="" alt="Spectrum">
        <div class="info" id="popup-info"></div>
    </div>
    <div class="legend">
        100 F-type stars (Teff ~ 6500K) from SDSS DR18
    </div>

    <script>
        // Plotly figure data
        var plotData = {"data":[{"customdata":[["spec-2942-54521-0299",2942,54521,299,6499.998,4.197913,-0.6734928,32.06958],["spec-2933-54617-0545",2933,54617,545,6500.003,3.694256,-1.402936,32.92429],["spec-1471-52883-0621",1471,52883,621,6499.992,3.562726,-0.9385148,21.49528],["spec-3457-54984-0185",3457,54984,185,6499.983,3.973569,-2.181874,15.93382],["spec-1155-52581-0351",1155,52581,351,6499.976,3.498577,-1.239487,13.84486],["spec-3224-54849-0628",3224,54849,628,6500.031,2.508306,-1.405063,18.31507],["spec-3368-54954-0144",3368,54954,144,6500.04,4.010345,-2.096204,12.97101],["spec-2537-53917-0422",2537,53917,422,6500.042,3.675776,-0.02958318,57.40348],["spec-1135-53024-0522",1135,53024,522,6499.936,3.790092,-1.645808,30.51825],["spec-2054-53431-0513",2054,53431,513,6500.065,3.80767,-0.4469707,49.76911],["spec-1473-52908-0116",1473,52908,116,6500.075,3.548688,-2.360583,11.91216],["spec-2323-54380-0484",2323,54380,484,6499.915,3.291273,-2.360926,11.85115],["spec-2149-54509-0595",2149,54509,595,6500.086,3.992482,-2.18019,40.48252],["spec-2079-53379-0367",2079,53379,367,6500.092,3.894066,-1.064644,25.03415],["spec-2890-54495-0531",2890,54495,531,6500.097,3.680463,-2.241212,46.38274],["spec-2184-53534-0386",2184,53534,386,6500.099,3.976727,-0.4085554,60.56522],["spec-2447-54498-0484",2447,54498,484,6500.101,3.183295,-2.05066,30.64676],["spec-2193-53888-0572",2193,53888,572,6499.893,3.948181,-2.956536,19.46417],["spec-3252-54893-0384",3252,54893,384,6499.893,3.413212,-1.945932,20.04539],["spec-2077-53846-0544",2077,53846,544,6499.892,3.650403,-2.111901,18.69932],["spec-2275-53709-0344",2275,53709,344,6499.885,3.685303,-2.511037,44.9056],["spec-2681-54397-0035",2681,54397,35,6499.882,3.583645,-0.2592348,23.46789],["spec-1299-52972-0626",1299,52972,626,6499.88,4.00654,-0.09920485,63.09865],["spec-3194-54833-0590",3194,54833,590,6499.868,2.34912,-1.921388,37.9028],["spec-2253-54551-0393",2253,54551,393,6500.147,3.635698,-2.147514,68.10445],["spec-1255-52962-0086",1255,52962,86,6499.85,3.935109,-0.3954776,21.65401],["spec-3166-54830-0090",3166,54830,90,6499.841,4.038,-1.907036,39.77129],["spec-2251-53557-0602",2251,53557,602,6500.166,3.534996,-1.61866,37.93298],["spec-2708-54561-0299",2708,54561,299,6500.167,3.636441,-1.831573,30.11278],["spec-2393-54156-0240",2393,54156,240,6500.168,3.491979,-2.411656,42.7943],["spec-3321-54924-0137",3321,54924,137,6499.825,4.030265,-1.509496,16.16839],["spec-1709-53533-0395",1709,53533,395,6500.177,3.251674,-1.956537,19.60179],["spec-2808-54524-0265",2808,54524,265,6499.819,4.033007,-0.2599674,68.89731],["spec-2300-53682-0325",2300,53682,325,6499.819,4.179001,-1.438484,37.26028],["spec-3138-54740-0321",3138,54740,321,6500.197,3.812672,-0.2717416,111.2063],["spec-2890-54495-0111",2890,54495,111,6500.203,3.948051,-0.3598936,62.80968],["spec-2716-54628-0567",2716,54628,567,6499.797,3.684477,-2.06129,35.66025],["spec-1255-52962-0001",1255,52962,1,6499.791,3.804192,-0.01107298,27.27673],["spec-2345-53757-0221",2345,53757,221,6500.212,3.488544,-1.989343,13.34504],["spec-2402-54176-0351",2402,54176,351,6500.227,3.636972,-2.180535,30.67924],["spec-3306-54922-0267",3306,54922,267,6500.26,3.767867,-1.979869,37.42698],["spec-2222-53799-0182",2222,53799,182,6500.26,4.214315,-1.204198,48.91996],["spec-2057-53816-0282",2057,53816,282,6499.738,3.559582,-1.846729,22.24392],["spec-2682-54401-0579",2682,54401,579,6500.267,4.076972,-0.4848809,73.99255],["spec-2544-53884-0391",2544,53884,391,6500.269,3.576376,-2.385926,15.37124],["spec-0289-51990-0182",289,51990,182,6500.271,3.198439,-1.234957,11.47195],["spec-3311-54943-0339",3311,54943,339,6500.284,4.213867,-2.048695,18.78932],["spec-2441-54065-0632",2441,54065,632,6499.707,3.886813,-0.5426165,36.75433],["spec-3193-54830-0119",3193,54830,119,6500.293,4.07368,-2.210028,19.5758],["spec-2561-54597-0085",2561,54597,85,6499.696,2.216371,-2.472801,10.4538],["spec-1337-52767-0587",1337,52767,587,6499.693,3.014683,-2.037635,15.7811],["spec-2410-54087-0539",2410,54087,539,6500.313,3.050674,-2.193315,15.56323],["spec-2931-54590-0123",2931,54590,123,6499.685,3.620874,-2.617152,13.62543],["spec-1880-53262-0077",1880,53262,77,6499.676,3.700543,-1.705195,18.26993],["spec-2078-53378-0017",2078,53378,17,6500.327,3.752556,-0.6696119,34.05963],["spec-2911-54631-0193",2911,54631,193,6499.671,4.167587,-0.4499348,91.75446],["spec-2965-54594-0005",2965,54594,5,6500.331,2.904762,-1.685863,17.88821],["spec-2299-53711-0164",2299,53711,164,6499.666,3.688546,-0.7860184,54.43302],["spec-2914-54533-0310",2914,54533,310,6499.652,2.178294,-2.362828,14.66638],["spec-3166-54830-0183",3166,54830,183,6499.65,3.644567,-0.734576,16.46017],["spec-1724-53859-0428",1724,53859,428,6499.648,3.778659,-0.9389728,11.64528],["spec-0760-52264-0537",760,52264,537,6500.366,3.867427,-1.069315,56.72699],["spec-3466-54998-0476",3466,54998,476,6500.374,2.741365,-3.082139,18.06568],["spec-2082-53358-0528",2082,53358,528,6499.615,3.603669,-0.572315,14.58989],["spec-0861-52318-0235",861,52318,235,6499.615,3.959926,-1.997607,42.67352],["spec-2250-53566-0315",2250,53566,315,6500.386,4.026299,-0.4407161,50.98166],["spec-3221-54864-0301",3221,54864,301,6500.39,4.35977,-1.905304,20.53077],["spec-2548-54152-0232",2548,54152,232,6499.605,3.915791,-0.9297819,37.20881],["spec-2414-54526-0402",2414,54526,402,6499.6,4.113926,-2.167825,12.21688],["spec-2337-53740-0455",2337,53740,455,6500.403,3.851163,-0.8573017,24.86205],["spec-2340-53733-0106",2340,53733,106,6499.592,2.690584,-2.375681,16.1162],["spec-3380-54977-0105",3380,54977,105,6499.59,3.347247,-2.453173,18.07689],["spec-2622-54095-0292",2622,54095,292,6499.59,3.874807,-0.7629619,22.96218],["spec-2402-54176-0520",2402,54176,520,6500.417,2.867239,-2.283726,18.61935],["spec-3127-54835-0482",3127,54835,482,6500.418,3.832573,-2.382697,13.74638],["spec-0858-52316-0236",858,52316,236,6499.577,3.687207,-2.097128,35.24626],["spec-3188-54831-0638",3188,54831,638,6500.429,4.313553,-0.4444964,24.20409],["spec-2548-54152-0499",2548,54152,499,6499.562,3.2847,-1.134014,18.34502],["spec-2401-53768-0384",2401,53768,384,6500.46,3.924869,-1.337403,10.28426],["spec-2964-54632-0525",2964,54632,525,6500.477,4.200202,-1.062439,37.36017],["spec-3454-55003-0259",3454,55003,259,6500.48,3.879364,-1.810498,11.98175],["spec-2672-54085-0244",2672,54085,244,6500.481,3.896137,-1.697303,76.06553],["spec-0888-52339-0144",888,52339,144,6500.483,3.987236,-0.07322669,54.22053],["spec-2207-53558-0251",2207,53558,251,6499.499,4.353763,-2.404651,21.59143],["spec-3174-54821-0141",3174,54821,141,6500.502,3.923946,-2.081154,20.98305],["spec-2403-53795-0111",2403,53795,111,6499.497,3.842292,-1.969917,12.19602],["spec-2515-54180-0389",2515,54180,389,6500.504,3.741568,-1.683709,17.59812],["spec-3362-54939-0256",3362,54939,256,6499.491,3.996939,-0.9470494,14.93891],["spec-2629-54087-0387",2629,54087,387,6499.484,3.557879,-2.54907,28.72547],["spec-2940-54508-0094",2940,54508,94,6499.479,3.810937,-0.5771427,72.15266],["spec-1150-52644-0437",1150,52644,437,6500.531,3.555849,-2.206135,10.48837],["spec-2620-54397-0436",2620,54397,436,6499.465,4.134802,-0.3523723,69.02972],["spec-2915-54497-0628",2915,54497,628,6499.459,3.699095,-1.846755,12.92009],["spec-2701-54154-0633",2701,54154,633,6500.547,3.899939,-0.7828907,14.91098],["spec-3152-54801-0574",3152,54801,574,6500.554,3.381732,-2.343558,29.66146],["spec-3388-54947-0127",3388,54947,127,6499.443,3.466162,-1.868187,32.41025],["spec-2186-54327-0318",2186,54327,318,6500.58,3.52211,-1.54993,29.85006],["spec-1150-52644-0324",1150,52644,324,6499.413,2.988357,-1.098879,11.82569],["spec-3222-54862-0343",3222,54862,343,6500.595,4.167951,-1.226579,15.18714],["spec-2907-54580-0541",2907,54580,541,6500.615,3.738109,-1.964998,79.16059]],"hovertemplate":"\u003cb\u003eRA:\u003c\u002fb\u003e %{x:.3f}\u003cbr\u003e\u003cb\u003eDec:\u003c\u002fb\u003e %{y:.3f}\u003cbr\u003e\u003cb\u003e[Fe\u002fH]:\u003c\u002fb\u003e %{customdata[6]:.2f}\u003cextra\u003e\u003c\u002fextra\u003e","marker":{"color":[-0.6734928,-1.402936,-0.9385148,-2.181874,-1.239487,-1.405063,-2.096204,-0.02958318,-1.645808,-0.4469707,-2.360583,-2.360926,-2.18019,-1.064644,-2.241212,-0.4085554,-2.05066,-2.956536,-1.945932,-2.111901,-2.511037,-0.2592348,-0.09920485,-1.921388,-2.147514,-0.3954776,-1.907036,-1.61866,-1.831573,-2.411656,-1.509496,-1.956537,-0.2599674,-1.438484,-0.2717416,-0.3598936,-2.06129,-0.01107298,-1.989343,-2.180535,-1.979869,-1.204198,-1.846729,-0.4848809,-2.385926,-1.234957,-2.048695,-0.5426165,-2.210028,-2.472801,-2.037635,-2.193315,-2.617152,-1.705195,-0.6696119,-0.4499348,-1.685863,-0.7860184,-2.362828,-0.734576,-0.9389728,-1.069315,-3.082139,-0.572315,-1.997607,-0.4407161,-1.905304,-0.9297819,-2.167825,-0.8573017,-2.375681,-2.453173,-0.7629619,-2.283726,-2.382697,-2.097128,-0.4444964,-1.134014,-1.337403,-1.062439,-1.810498,-1.697303,-0.07322669,-2.404651,-2.081154,-1.969917,-1.683709,-0.9470494,-2.54907,-0.5771427,-2.206135,-0.3523723,-1.846755,-0.7828907,-2.343558,-1.868187,-1.54993,-1.098879,-1.226579,-1.964998],"colorbar":{"len":0.7,"thickness":15,"title":{"side":"right","text":"[Fe\u002fH]"}},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"line":{"color":"white","width":1},"size":10},"mode":"markers","x":[70.593848,217.79059,18.751426,252.41504,33.843436,146.19411,199.96925,333.2267,9.1292816,116.46496,328.62109,332.68074,225.79634,114.07253,116.22827,270.60003,214.76489,261.61279,183.82251,124.57282,126.9077,72.705398,135.04309,150.82544,261.83204,67.316692,118.16991,333.73985,166.20008,168.21965,146.73216,217.40221,254.6131,80.661565,302.31959,116.63902,210.67465,67.658068,149.94607,140.36128,182.10231,176.47583,122.6696,102.10594,285.30544,186.76463,214.6914,47.69071,150.35087,262.85529,246.2508,164.06411,213.00679,359.18154,115.09944,231.19659,194.0799,92.387552,142.65266,117.45274,234.74284,125.37541,239.96154,124.61093,122.28998,311.10471,173.61803,87.671974,169.36791,106.43783,48.497512,209.36669,353.65631,141.9028,36.862981,117.08291,126.27725,89.087517,138.33552,219.92726,237.31477,78.563025,114.68319,247.73392,126.17472,148.04781,177.62872,125.80485,346.53124,119.81598,117.46985,334.79388,117.07653,115.2123,155.89091,223.19795,240.18091,116.65164,171.89085,218.00398],"y":[-6.355519,8.886937,47.134855,33.743085,0.040313,39.139511,40.907117,69.609235,0.75951749,18.248415,-0.316389,6.874943,24.795933,22.686218,18.779775,23.850213,56.610052,27.68355,5.5783734,0.309768,19.606315,21.358537,8.0929438,43.997784,33.240387,25.034562,28.609605,21.639876,-17.195572,9.143862,43.176962,10.696155,28.031723,62.717661,-11.064137,17.907364,-8.292081,24.548691,27.388572,7.355481,-0.51353216,29.720942,-0.346668,38.395539,39.158725,-0.19006309,36.698455,37.924035,44.759993,63.466379,38.279882,49.034061,35.46365,36.326796,21.065549,38.950778,9.143357,63.956543,29.694184,29.535384,8.3550215,40.840778,43.876605,19.830575,31.030348,14.946596,26.10581,83.353194,59.822528,66.810912,4.7859,41.183605,7.931558,7.554811,0.55498668,26.368881,30.775714,83.551265,30.765836,21.92023,45.785431,16.160456,27.032935,16.268969,46.98692,61.778782,20.396374,55.993438,22.740777,8.99425,35.478298,39.538669,18.377922,41.205937,36.665073,8.6928498,5.135091,35.736481,28.629021,45.802099],"type":"scatter"}],"layout":{"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"title":{"font":{"size":20},"text":"SDSS F Stars Sky Map","x":0.5,"xanchor":"center"},"xaxis":{"title":{"text":"RA (deg)"},"autorange":"reversed","showgrid":true,"gridwidth":1,"gridcolor":"rgba(128,128,128,0.3)","range":[360,0]},"yaxis":{"title":{"text":"Dec (deg)"},"showgrid":true,"gridwidth":1,"gridcolor":"rgba(128,128,128,0.3)","range":[-20,90]},"hoverlabel":{"font":{"size":12,"family":"monospace"},"bgcolor":"white"},"margin":{"l":60,"r":60,"t":80,"b":60},"plot_bgcolor":"#f8f9fa","paper_bgcolor":"white"}};

        // Render plot
        Plotly.newPlot('sky-plot', plotData.data, plotData.layout, {
            responsive: true,
            displayModeBar: true,
            modeBarButtonsToRemove: ['lasso2d', 'select2d']
        });

        var plot = document.getElementById('sky-plot');
        var popup = document.getElementById('spectrum-popup');
        var popupImg = document.getElementById('popup-img');
        var popupInfo = document.getElementById('popup-info');

        // Handle hover
        plot.on('plotly_hover', function(data) {
            var point = data.points[0];
            var cd = point.customdata;
            var filename = cd[0];
            var plate = cd[1];
            var mjd = cd[2];
            var fiber = cd[3];
            var teff = cd[4];
            var logg = cd[5];
            var feh = cd[6];
            var snr = cd[7];

            // Set image source
            popupImg.src = 'spectrum_plots/' + filename + '.png';

            // Set info text
            popupInfo.innerHTML =
                '<span><b>Plate-MJD-Fiber:</b> ' + plate + '-' + mjd + '-' + fiber + '</span>' +
                '<span><b>Teff:</b> ' + teff.toFixed(0) + ' K</span>' +
                '<span><b>log g:</b> ' + logg.toFixed(2) + '</span>' +
                '<span><b>[Fe/H]:</b> ' + feh.toFixed(2) + '</span>' +
                '<span><b>S/N:</b> ' + snr.toFixed(1) + '</span>';

            popup.style.display = 'block';

            // Position popup near cursor
            var evt = data.event;
            positionPopup(evt.clientX, evt.clientY);
        });

        // Update popup position on mouse move over plot
        plot.addEventListener('mousemove', function(evt) {
            if (popup.style.display === 'block') {
                positionPopup(evt.clientX, evt.clientY);
            }
        });

        function positionPopup(x, y) {
            var popupWidth = popup.offsetWidth || 650;
            var popupHeight = popup.offsetHeight || 400;
            var offset = 20;

            // Default: position to the right and below cursor
            var left = x + offset;
            var top = y + offset;

            // Adjust if popup would go off right edge
            if (left + popupWidth > window.innerWidth - 10) {
                left = x - popupWidth - offset;
            }

            // Adjust if popup would go off bottom edge
            if (top + popupHeight > window.innerHeight - 10) {
                top = y - popupHeight - offset;
            }

            // Ensure not off left or top edge
            left = Math.max(10, left);
            top = Math.max(10, top);

            popup.style.left = left + 'px';
            popup.style.top = top + 'px';
        }

        // Hide popup when not hovering
        plot.on('plotly_unhover', function() {
            popup.style.display = 'none';
        });
    </script>
</body>
</html>
